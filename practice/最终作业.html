<!DOCTYPE html>
<html>
<head>
<title>test</title>
<meta charset="utf-8" />
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>

<style type="text/css">

.body{
	padding: 0;
	width:400px;
	height:800px;
	border: 1px solid green;
	overflow: hidden;
	position: relative;
	background-color: rgb(252,250,242);
}

.add_page_A{
	width:400px;
	height: 800px;
	position: absolute;
	background-color: rgb(252,250,242);
	top:100%;
	border: 1px solid green;
	animation: to_add_page_A 0.5s;
}

.add_page_A2{
	width:400px;
	height: 800px;
	position: absolute;
	background-color: rgb(252,250,242);
	top:0;
	border: 1px solid green;
	animation: to_add_page_A2 0.78s;
}

@keyframes to_add_page_A{
	from{top:0%}
	to{top:100%}
}

@keyframes to_add_page_A2{
	from{top:100%}
	to{top:0}
}


.cash_input{
	padding: 0;
	list-style: none;
}

.cash_input::after{
	content:'.';
	font-size:0;
	display:block;
	clear:both;
}
.cash_input>li:first-child{
	float: left;
	display: block;
	color:black;
}
.cash_input>li:nth-child(2){
	float: right;
	display: block;

}

.item_type{
	list-style:none;
	padding:0;
	loutline:1px dashed red;
	margin:0 -10px -10px 0;/*外边距：上右下左*/
	background-color: rgb(189,192,186);
	color:block;
}

.item_type::after{
	content:'.';
	font-size:0;
	display:block;
	clear:both;
}


.item_type>li{
	float:left;
	loutline:1px solid yellow;
	width: 25%;
}

.li_checked{
	float:left;
	loutline:1px solid yellow;
	width: 25%;
	background:rgb(180,165,130);
}

.item_type>li>a{
	display:block;
	margin:0 10px 10px 20px;
	font-size:1px;
}

.item_type>li>a>input{
	display:none
}

.num_pannel{
	position: relative;
	top:55%;
}

.num_pannel>ul{
	list-style:none;
	padding:0;
	loutline:1px dashed red;
	margin:0 -10px -10px 0;/*外边距：上右下左*/
	background-color: rgb(189,192,186);
}

.num_pannel>ul::after{
	content:'.';
	font-size:0;
	display:block;
	clear:both;
}

/* .test>li{
	float: left;
	display: block;
	margin:0 2px 2px 0;
	width: 25%;	
	border: 1px solid green;
} */
.num_pannel>ul>li{
	float:left;
	loutline:1px solid yellow;
	width: 25%;
}
.num_pannel>ul>li>a{
	display:block;
	margin:2px 10px 10px 30px;
}



#add_button{
	position: absolute;
	display: block;
	top:95%;
	left: 43%;
}

#show{
	position: absolute;
}

#show>ul{
	list-style: none;
}

.show_chart_1{
	width:400px;
	height: 800px;
	position: absolute;
	background-color:beige;
	left:100%;
	animation: to_show_chart_1 0.75s;
	z-index: 2;
}

.show_chart_2{
	width:400px;
	height: 800px;
	position: absolute;
	left:0%;
	background-color:beige;
	animation: to_show_chart_2 0.75s;
	z-index: 2;
}

@keyframes to_show_chart_2{
	from{left:100%}
	to{left:0%}
}

@keyframes to_show_chart_1{
	from{left:0%}
	to{left:100%}
}

.show_chart_2>a{
	position: absolute;
	top:50%;
	left: 90%;
}

#show_chart_button{
	display: block;
	position: absolute;
	left: 90%;
	top:50%;
}
</style>
</head>
<body>
	
	<div class="body">
		<div class="show_chart_1">
			<canvas id="myChart"></canvas>
			<a onclick="javascript:close_chart_button();"><img src="./arrow-point-to-right.png"></a>
		</div>
		<div id="show">
				<ul id="items"></ul>
		</div>
		<br>
		<button type="button" id="add_button" onclick="show_add_page()">記一筆</button>
		<a id="show_chart_button" onclick="javascript:show_chart_button()"><img src="./left-arrow.png"></a>
		<div class="add_page_A">
			<button type="button" onclick="close_add_page()">X</button>
			<ul class="cash_input">
				<li>花銷</li>
				<li><input id="input_money"></li>
			</ul>
			<ul class="item_type">
				<li onclick="test(this)" class="li_checked"><a><img src="./ice-cream.png"><input type="radio" class="checkbox" value="食物" name="item" checked=true>食物</a></li>
				<li onclick="test(this)"><a><img src="./ice-cream.png"><input type="radio" class="checkbox" value="飲料" name="item">飲料</a></li>
				<li onclick="test(this)"><a><img src="./ice-cream.png"><input type="radio" class="checkbox" value="交通" name="item">交通</a></li>
				<li onclick="test(this)"><a><img src="./ice-cream.png"><input type="radio" class="checkbox" value="購物" name="item">購物</a></li>
				<li onclick="test(this)"><a><img src="./ice-cream.png"><input type="radio" class="checkbox" value="測試" name="item">測試</a></li>
			</ul>
			<br>
			<div class="num_pannel">
				<ul>
					<li><a onclick="javascript:input_nums(7);"><img src="./number-seven-in-a-circle.png"></a></li>
					<li><a onclick="javascript:input_nums(8);"><img src="./number-eight-in-a-circle.png"></a></li>
					<li><a onclick="javascript:input_nums(9);"><img src="./number-nine-in-a-circle.png"></a></li>
					<li><a onclick="javascript:back_num();"><img src="./left-arrow.png"></a></li>
					<li><a onclick="javascript:input_nums(4);"><img src="./number-four-in-circular-button.png"></a></li>
					<li><a onclick="javascript:input_nums(5);"><img src="./number-five-in-circular-button.png"></a></li>
					<li><a onclick="javascript:input_nums(6);"><img src="./number-six-in-a-circle.png"></a></li>
					<li><a onclick="javascript:add_or_min_num('add')"><img src="./plus.png"></a></li>
					<li><a onclick="javascript:input_nums(1);"><img src="./number-one-in-a-circle.png"></a></li>
					<li><a onclick="javascript:input_nums(2);"><img src="./number-two-in-a-circle.png"></a></li>
					<li><a onclick="javascript:input_nums(3);"><img src="./number-three-in-a-circle.png"></a></li>
					<li><a onclick="javascript:add_or_min_num('min')"><img src="./minus.png"></a></li>
					<li><a><img src="./minus.png"></a></a></li>
					<li><a onclick="javascript:input_nums(0)"><img src="./number-zero-in-a-circle.png"></a></a></li>
					<li><a><img src="./minus.png"></a></a></li>
					<li><a onclick="javascript:change()"><img src="./verified.png"></a></a></li>
				</ul>
			</div> 
		</div>
	</div>
	<div>Icons made by <a href="https://www.freepik.com/" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/"                 title="Flaticon">www.flaticon.com</a> is licensed by <a href="http://creativecommons.org/licenses/by/3.0/"                 title="Creative Commons BY 3.0" target="_blank">CC 3.0 BY</a></div>
</body>


<script>
	function print(i){
		console.log(i);
	}

	function test(e){
		var pa = document.getElementsByClassName("item_type")[0];
		var items = pa.getElementsByTagName("li")
		for(var i=0;i<items.length;i++){
			items[i].classList.remove("li_checked")
		}
		var item = e;
		item.classList.add("li_checked");
		var r = item.getElementsByTagName("input")[0]
		r.checked = true;
	}

	function show_add_page(){
		var item = document.getElementsByClassName("add_page_A")[0];
		item.classList.remove("add_page_A");
		item.classList.add("add_page_A2");
	}

	function close_add_page(){
		var item = document.getElementsByClassName("add_page_A2")[0];
		item.classList.remove("add_page_A2");
		item.classList.add("add_page_A");
		var item = document.getElementById("input_money");
		item.value = "";
	}

	function show_chart_button(){
		var item = document.getElementsByClassName("show_chart_1")[0];
		item.classList.remove("show_chart_1");
		item.classList.add("show_chart_2");
		cost_list = [cost_dir['食物'], cost_dir['飲料'], cost_dir['購物'], cost_dir['交通']]
		draw_chart()
	}

	function close_chart_button(){
		var item = document.getElementsByClassName("show_chart_2")[0];
		item.classList.remove("show_chart_2");
		item.classList.add("show_chart_1");
	}

	function input_nums(num){
		var item = document.getElementById("input_money");
		var cur_num = item.value;
		var new_num = String(cur_num)+num;
		item.value = new_num;
	}

	function back_num(){
		var item = document.getElementById("input_money");
		var cur_num = item.value;
		var new_num = String(cur_num).slice(0,-1);
		item.value = new_num;
	}

	function add_or_min_num(op){
		var item = document.getElementById("input_money");
		var cur_num = item.value;
		if(op == "add"){
			var new_num = parseInt(cur_num)+1;
		}else if(op=="min"){
			var new_num = cur_num-1;
		}
		item.value = new_num;
	}

	function get_item_type(){
		var items = document.getElementsByClassName("checkbox");
		print(items)
		var i;
		for(i=0;i<items.length;i++){
			if(items[i].checked==true)
			{
				return items[i].value;
			}
		}
	}

	function change(){
		var items = document.getElementById("items");
		
		var current_date = generate_date_string();
		var is_new_day=true;
		
		items_li = items.getElementsByTagName('li')
		for(var i=0;i<items_li.length;i++){
			if(items_li[i].innerHTML==current_date){
				is_new_day = false;
				break;
			}
		}
		if (is_new_day){
			var new_date = document.createElement("li");
			new_date.innerHTML=current_date;
			var bar = document.createElement("li");
			bar.innerHTML="-------------------------------------------";
			items.appendChild(bar);
			items.appendChild(new_date);
		}
		var item = document.createElement("li");
		var item_type = get_item_type()
		var item_cost = document.getElementById("input_money").value
		item.innerHTML = item_cost+"................."+item_type;
		items.appendChild(item);

		cost_dir[item_type] += parseInt(item_cost);
		print(cost_dir);

		// var summary = document.getElementById("summary")
		// var p = summary.children[0];
		// p.innerHTML = li_sum();
		close_add_page();
	}
	
	function li_sum(){
		var items = document.getElementById("items").children;
		var sum = 0
		for(i=0;i<items.length;i++){
			sum += parseInt(items[i].innerHTML)
		}
		console.log(sum)
		return sum
	}
	console.log("test")

	function draw_chart(){
		var mydata={
				datasets: [{
					data: cost_list,
					backgroundColor: [
						'rgba(255, 99, 132, 0.2)',
						'rgba(54, 162, 235, 0.2)',
						'rgba(255, 206, 86, 0.2)',
						'rgba(75, 192, 192, 0.2)']
				}],

				// These labels appear in the legend and in the tooltips when hovering different arcs
				labels: [
					'食物',
					'飲料',
					'購物',
					'交通'
				]
			}
		var ctx = document.getElementById('myChart').getContext('2d');
		var myPieChart = new Chart(ctx, {
			type: 'pie',
			data: mydata,
			options: {}
		});
	}

	cost_dir={'食物':0,'飲料':0, '購物':0,'交通':0,'測試':0}
	
	function generate_date_string(){
		var curTime = new Date();
		var day = curTime.getDate();
		var year = curTime.getFullYear();
		var month = curTime.getMonth()+1;
		return year+'-'+month+'-'+day;
	}
</script>
</html>
